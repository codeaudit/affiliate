<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Buy Coin</title>
    <script src="/s/jquery.js"></script>
</head>
<body>
<h1>Buy Coin</h1>
<form method="POST" name="form" action="">
<input type="hidden" name="ref" value="{{.Ref}}"/>
Please Input your wallet address:<br />
<input type="text" name="address" value=""/>
<br />
Please Choose Cryptocurrency type:<br />
{{range .AllCurrency}}
    <input type="radio" id="choice-{{.ShortName}}"
     name="currencyType" value="{{.ShortName}}">
    <label for="choice-{{.ShortName}}">{{.FullName}} (1{{.ShortName}}={{.Rate}} {{$.CoinName}})</label>
{{end}}
</form>
<br />
<button onclick="getAddress()">Get Address</button>
<button onclick="checkStatus()">Check Status</button> 
<script>
function validate(form){
	if(!form.elements['address'].value){
    	alert('请输入地址');
    	return false;
    }
    var radios = form.elements['currencyType'];
    var valid = false;
    for (var i = 0; i < radios.length; i++){
     if (radios[i].checked){
      valid = true;
      break;
     }
    }
    if(!valid){
    	alert('请选择数字货币类型。');
    	return false;
    }
	return true
}
function getAddress(){
    var form = document.forms['form'];
    if(!validate(form)){
    	return;
    }
    $.ajax({ url: './get-address/', method: 'POST', data: $(form).serialize(), dataType: 'json', success: function(obj){
    	if(obj){
    		if(obj.code===0){
    			$('#depositAddr').text(obj.data.depositAddr);
    			$('#depositAddrDiv').show();
    		}else{
    			alert(obj.errmsg);
    		}
    	}else{
    		alert("出现错误"); 		
    	}
      }});
}
function checkStatus(){
    var form = document.forms['form'];
    if(!validate(form)){
    	return;
    }
    $.ajax({ url: './check-status/', method: 'POST', data: $(form).serialize(), dataType: 'json', success: function(obj){
    	if(obj){
    		if(obj.code===0){
    			$('#statusRes').text(obj.data);
    			$('#statusDiv').show();
    		}else{
    			alert(obj.errmsg);
    		}
    	}else{
    		alert("出现错误"); 		
    	}
      }});
}
</script>
<div id="depositAddrDiv" style="display:none;">
<br /><br /><br />
Deposit Address:<span id="depositAddr"></span>
</div>
<div id="statusDiv" style="display:none;">
<br /><br />
<span id="statusRes"></span>
</div>
</body>
</html>