<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Affiliate Portal</title>
    <link href="/s/bootstrap/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container">
<h1>Affiliate Portal</h1>
<p>
</p>
<p>
SPACO, is a distributed next-generation network protocol,
which significantly improves on the current HTTP/HTTPS internet protocols.
SPACO opens the floodgates and allows anyone to be a network operator,
Instead of all resources being controlled by few industry giants.
Network resources and integrity are protected using our redundancy and smart contracts.
SPACO have a great advantage being distributed along with its reliability and also
its privacy protection in relation to the current Internet.
</p>
<p>
</p>
<form method="POST" name="form" id="form" action="" role="form">
<input type="hidden" name="ref" value="{{.Ref}}"/>
<div class="form-group">
<label for="address">Please Input your wallet address:</label>
<input type="text" name="address" value="" id="address" class="form-control" placeholder="wallet address" size="60" maxlength="60"/>
</div>
</form>
<br />
<div>
<button type="button" class="btn btn-primary" onclick="generate()">Generate Tracking URL</button>
<button type="button" class="btn btn-default" onclick="myInvitation()">My Invitation</button> 
</div>
<div id="shareUrlDiv" class="alert alert-success" role="alert" style="display:none;">
<div>
<label for="buyUrl" style="display:block;">Buy skycoin URL:</label>
<span id="buyUrl"></span>
</div>
<div>
<label for="joinUrl" style="display:block;">Join affiliate program URL:</label>
<span id="joinUrl"></span>
</div>
</div>
<div id="myInvitationDiv" class="alert alert-success" role="alert" style="display:none;">
</div>
</div>
<script>
function validate(form){
	if(!form.elements['address'].value){
    	alert('请输入地址');
    	return false;
    }
	return true
}

function generate(){
    var form = document.forms['form'];
    if(!validate(form)){
    	return;
    }
    $.ajax({ url: './generate/', method: 'POST', data: $(form).serialize(), dataType: 'json', success: function(obj){
    	if(obj){
    		if(obj.code===0){
    			$('#buyUrl').text(obj.data.buyUrl);
    			$('#joinUrl').text(obj.data.joinUrl);
    			$('#shareUrlDiv').show();
    		}else{
    			alert(obj.errmsg);
    		}
    	}else{
    		alert("出现错误"); 		
    	}
      }});
}
function myInvitation(){
    var form = document.forms['form'];
    if(!validate(form)){
    	return;
    }
    $.ajax({ url: './my-invitation/', method: 'POST', data: $(form).serialize(), dataType: 'json', success: function(obj){
    	if(obj){
    		if(obj.code===0){
    			$.views.settings.delimiters("[[", "]]");
    			var tmpl = $.templates('#tmpl')
    			$("#myInvitationDiv").html(tmpl.render(obj.data));
    			$('#myInvitationDiv').show();
    		}else{
    			alert(obj.errmsg);
    		}
    	}else{
    		alert("出现错误"); 		
    	}
      }});
}
</script>
<script type="text/x-jsrender" id="tmpl">
<span>got [[:records.length]] times reward.</span>
</script>
<script src="/s/jquery.js"></script>
<script src="/s/jsrender.js"></script>
<script src="/s/bootstrap/js/bootstrap.min.js"></script>
</body>
</html>